{
  "name": "Weggever: Coco Prompt Optimizer > Brevo",
  "nodes": [
    {
      "parameters": {
        "form": "sBSMVLYdixus"
      },
      "type": "n8n-nodes-fillout.filloutTrigger",
      "typeVersion": 1,
      "position": [
        -140,
        20
      ],
      "id": "59675440-3270-421a-8a6e-b94d5dfce9b3",
      "name": "Fillout Trigger",
      "webhookId": "83e92f27-da5c-48e9-a27e-7e808d546516",
      "credentials": {
        "filloutApi": {
          "id": "cpCkrQqQqntZaWlR",
          "name": "Fillout account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const q = item.json.questions || {};\n  let raw = String(q['3j97']?.value || '').trim();\n\n  // strip rommel\n  raw = raw.replace(/\\s+/g, '').replace(/[().-]/g, '');\n\n  // 00 -> +\n  if (raw.startsWith('00')) raw = '+' + raw.slice(2);\n\n  // Als nog geen +: simpele NL/BE heuristiek\n  if (!raw.startsWith('+')) {\n    if (/^0\\d{9}$/.test(raw)) {        // NL 06/0xx\n      raw = '+31' + raw.slice(1);\n    } else if (/^(31|32)\\d{8,11}$/.test(raw)) {\n      raw = '+' + raw;\n    }\n  }\n\n  // Validatie E.164 (8â€“15 cijfers)\n  if (!/^\\+\\d{8,15}$/.test(raw)) raw = null;\n\n  return { json: { ...item.json, smsE164: raw } };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        20,
        20
      ],
      "id": "db260137-13f7-4b85-94db-a18afc1df3fa",
      "name": "Code"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.brevo.com/v3/contacts",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api-key",
              "value": "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"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"email\": \"{{ $json.questions.cnPV.value }}\",\n  \"sms\": \"{{ $json.smsE164 }}\",\n  \"attributes\": {\n    \"FIRSTNAME\": \"{{ $json.questions.rrfU.value }}\",\n    \"LASTNAME\": \"{{ $json.questions['7SmA'].value }}\",\n    \"PHONE\": \"{{ $json.smsE164 }}\"\n  },\n  \"listIds\": [7],\n  \"updateEnabled\": true\n}",
        "options": {}
      },
      "id": "d4851527-787f-42bc-8577-cfee80065d1a",
      "name": "HTTP Request: Brevo Upsert",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        240,
        20
      ],
      "alwaysOutputData": true
    }
  ],
  "pinData": {},
  "connections": {
    "Fillout Trigger": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "HTTP Request: Brevo Upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d58fdd9b-8c05-4cd6-bf81-20bcf35ce1b3",
  "meta": {
    "instanceId": "6e54678a53d7f49248c5f099ed5a913abc90c7037941e56ed5af77444c54e2c4"
  },
  "id": "xCSeXDLpQgAHdIlq",
  "tags": []
}